# =========================
# Phemex API Keys
# Trade (운영 체결) — TESTNET 스위치
# =========================
PHEMEX_TESTNET=true                 # true=테스트넷, false=메인넷

# DEV(테스트넷) 키
PHEMEX_API_KEY_DEV=
PHEMEX_SECRET_DEV=

# PROD(메인넷) 키
PHEMEX_API_KEY_PROD=
PHEMEX_SECRET_PROD=

# (구버전 호환) 위 값이 비어있을 때만 폴백
PHEMEX_API_KEY=
PHEMEX_SECRET=

# ====== Regime(추세 데이터) 소스 선택 ======
REGIME_EXCHANGE=binance             # phemex | binance
REGIME_TESTNET=false                # binance면 보통 false 권장(데이터 충실)
REGIME_BINANCE_MARKET=spot          # spot | usdm       (기본: spot 추천)
REGIME_SYMBOL_ETH=                  # 비워두면 자동 정규화
REGIME_SYMBOL_BTC=

# --- Binance용 선택지 (레짐 전용; 모두 옵션) ---
REGIME_BINANCE_API_KEY_DEV=         # 필요 없으면 비워두세요(공개 엔드포인트로 충분)
REGIME_BINANCE_SECRET_DEV=
REGIME_BINANCE_API_KEY_PROD=
REGIME_BINANCE_SECRET_PROD=

# (선택) 레짐용 Phemex 키 (비워도 됨; 공개 OHLCV/펀딩은 대부분 무키로도 가능)
REGIME_PHEMEX_API_KEY_DEV=
REGIME_PHEMEX_SECRET_DEV=
REGIME_PHEMEX_API_KEY_PROD=
REGIME_PHEMEX_SECRET_PROD=

# (선택) 레짐 심볼 강제 (비우면 자동 정규화)
REGIME_SYMBOL_ETH=
REGIME_SYMBOL_BTC=

# TradingView에서 심볼이 안 올 경우 fallback (ccxt 통일 심볼)
SYMBOL=ETH/USDT:USDT

# =========================
# Redis (Idempotency)
# =========================
# 로컬 개발: localhost, Docker 네트워크: redis (docker-compose가 app에서 override 가능)
REDIS_URL=redis://localhost:6379/0
IDEMPOTENCY_TTL=900

# =========================
# Risk & Order Controls
# =========================
MAX_SLIPPAGE=0.004
FEE_BUFFER=0.003
RECONCILE_RETRIES=8
RECONCILE_INTERVAL=1.5
USE_MARK_PRICE=true
TAKER_FEE=0.0006
MIN_NOTIONAL_USDT=5

# =========================
# Server-side Sizing (defaults)
# =========================
SERVER_SIZING=true
SIZING_MODE=notional                          # risk | notional | fixed
RISK_PCT=0.1                                 # 계좌 대비 1% 위험
ALLOC_PCT=0.5                                # (fallback) notional 모드에서만 사용
LEVERAGE_DEFAULT=5                            # 보수적 기본 레버리지
MARGIN_BUFFER=0.98

# =========================
# Regime Gate (전략별 배분/레버리지 맵)
# =========================
# BULL 전략
ALLOC_BULL_BULL=0.80
ALLOC_BULL_NEUTRAL=0.65
ALLOC_BULL_BEAR=0.10
LEV_BULL_BULL=8
LEV_BULL_NEUTRAL=6
LEV_BULL_BEAR=3

# BEAR 전략
ALLOC_BEAR_BULL=0.00
ALLOC_BEAR_NEUTRAL=0.10
ALLOC_BEAR_BEAR=0.75
LEV_BEAR_BULL=3
LEV_BEAR_NEUTRAL=4
LEV_BEAR_BEAR=8

# =========================
# Cooldown / Daily Drawdown
# =========================
LOSS_STREAK_LIMIT_BULL=5
LOSS_STREAK_LIMIT_BEAR=4
COOLDOWN_MIN_BULL=90
COOLDOWN_MIN_BEAR=120
DAILY_MAX_DD_USDT=0                             # 0=비활성, 일일 DD 한도(USDT)

# =========================
# Funding / VIX / Edge 추정
# =========================
FUNDING_ABS_MAX=0.03                            # |fundingRate| > 3%/8h 차단
ASSUME_HOLD_HOURS=2.0                           # 펀딩 비용 추정을 위한 평균 보유시간(시간)
VIX_URL=                                        # (옵션) 내부 프록시나 API 엔드포인트
VIX_MAX=30
EDGE_FILTER_ENABLED=false
EDGE_REQUIRE_TP=false          # ← 없으면 스킵
EDGE_ALLOW_DERIVE_TP=true      # ← ATR로 추정 허용
EDGE_ATR_TP_X=3.0              # ← 추정 멀티플(원하는 값)
MIN_EDGE_USDT=0.0              # ← 음수만 차단(또는 소액 필터)


# One-Way(기본) 또는 Hedge
PHEMEX_POSITION_MODE=hedge   # 계정이 Hedge 모드라면 hedge, One-Way면 oneway

# =========================
# Relay Shared Secret
# =========================
RELAY_SHARED_SECRET=tonymin

# =========================
# Logging
# =========================
LOG_LEVEL=INFO
LOG_JSON=true
LOG_TO_FILE=false
LOG_FILE=/app/relay.log

# =========================
# Equity Config
# =========================
EQUITY_CODE=USDT
EQUITY_SOURCE=free
BALANCE_DEBUG=true